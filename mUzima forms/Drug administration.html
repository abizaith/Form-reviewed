<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/muzima.css" rel="stylesheet">
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="css/ui-darkness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/muzima.js"></script>
</head>
<body class="col-md-10 col-md-offset-1">
<div id="pre_populate_data"></div>
<form id="VitalSigns_form" name="VitalSigns_form">
    <div class="section">
        <fieldset>
            <h2>DRUG ORDERS</h2>
            <h3>Encounter Details</h3>
            <div class="form-group">
                <label for="encounter.location_id">Location Name:<span class="required">*</span></label>
                <input class="form-control valid-location-only" id="encounter.location_id" type="text" placeholder="Start typing something..."
                       required="required">
                <input class="form-control" name="encounter.location_id" type="hidden">
            </div>
            <div class="form-group">
                <label for="encounter.provider_id_select">Provider:</label>
                <input class="form-control valid-provider-only" id="encounter.provider_id_select" type="text" placeholder="Start typing something...">
                <input class="form-control" name="encounter.provider_id_select" type="hidden">
            </div>
            <div class="form-group hidden">
                <select id="select_providers"></select>
            </div>
            <div class="form-group show_provider_id_text">
                <label for="encounter.provider_id">Provider's system-id:<span class="required">*</span></label>
                <input class="form-control checkDigit" id="encounter.provider_id" name="encounter.provider_id"
                       type="text" required="required" disabled="disabled">
            </div>
            <div class="form-group">
                <label for="encounter.encounter_datetime">Encounter Date:<span class="required">*</span></label>
                <input class="form-control datepicker nonFutureDate past-date" id="encounter.encounter_datetime"
                       name="encounter.encounter_datetime" type="text" readonly="readonly"
                       required="required">
            </div>
            <div class="form-group">
                <input class="form-control" id="encounter.form_uuid" name="encounter.form_uuid"
                       type="hidden" required="required">
            </div>
        </fieldset>
    </div>
    <div class="section">
        <fieldset>
            <h3>DEMOGRAPHICS & CLINICAL MEASUREMENTS</h3>

            <div class="form-group">
                <input class="form-control" id="patient.uuid"
                       name="patient.uuid" type="hidden" readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.medical_record_number">Patient identifier:</label>
                <input class="form-control" id="patient.medical_record_number"
                       name="patient.medical_record_number" type="text" readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.given_name">Given Name:</label>
                <input class="form-control" id="patient.given_name" name="patient.given_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.middle_name">Middle Name:</label>
                <input class="form-control" id="patient.middle_name" name="patient.middle_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.family_name">Family Name:</label>
                <input class="form-control" id="patient.family_name" name="patient.family_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.sex">Gender:</label>
                <select class="form-control" id="patient.sex" name="patient.sex" disabled="disabled">
                    <option value="">...</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                </select>
            </div>
            <div class="form-group">
                <label for="patient.birth_date">Date Of Birth:</label>
                <input class="form-control" id="patient.birth_date" name="patient.birth_date" type="text"
                       readonly="readonly" disabled="disabled">
            </div>
        </fieldset>
    </div>


    <h3>COMPLEMENTARY DRUG</h3>
    <fieldset>
        <div class="form-group">
            <label>Drug list:</label>
            <textarea class="form-control" id="obs.OtherDrugs" name="obs.OtherDrugs" type="text"  rows="2" data-concept="aaa7aeff-c1cc-4c34-befc-0821c7f5e2e0^Other Drugs^99DCT"></textarea>
        </div>

        <div class="form-group">
            <label for="DRUGFREQUENCYCODED">Dosage:</label>
            <select class="form-control" id="obs.DRUGFREQUENCYCODED" name="obs.DRUGFREQUENCYCODED" data-concept="71ffb8ee-382e-4ad0-9b42-0b665f81aaf9^DRUG FREQUENCY CODED^99DCT">
                <option value="">...</option>
                <option value="3322^TWICE A DAY ^99DCT">TWICE A DAY </option>
                <option value="3321^ONCE A DAY ^99DCT">ONCE A DAY </option>
                <option value="3324^ONCE A MONTH ^99DCT">ONCE A MONTH </option>
                <option value="3323^THREE A DAY ^99DCT">THREE A DAY </option>
                <option value="3325^TWICE A MONTH ^99DCT">TWICE A MONTH </option>
                <option value="6100^FOUR TIMES A DAY ^99DCT">FOUR TIMES A DAY </option>
                <option value="6101^FIVE TIMES A DAY ^99DCT">FIVE TIMES A DAY </option>
                <option value="6105^IN THE MORNING^99DCT">IN THE MORNING</option>
                <option value="6106^IN THE EVENING ^99DCT">IN THE EVENING </option>
                <option value="6103^EVERY OTHER DAY ^99DCT">EVERY OTHER DAY </option>
                <option value="6102^SIX TIMES A DAY^99DCT">SIX TIMES A DAY</option>
                <option value="2099^ONCE A WEEK ^99DCT">ONCE A WEEK </option>
                <option value="6104^ONCE A DAY AT NIGHT ^99DCT">ONCE A DAY AT NIGHT </option>
                <option value="13461^PER NEED^99DCT">PER NEED</option>
            </select>
        </div>
        <div class="form-group">
            <label>Allergy:</label>
            <textarea class="form-control" id="obs.ALLERGYCOMMENT" name="obs.ALLERGYCOMMENT" type="text"  rows="2" data-concept="38b0118c-1cf4-40a9-a508-15c48d9586ac^Tests other result^99DCT"></textarea>
        </div>
    </fieldset>
    </div>
    </div>
    </div>

</form>
</body>
<script type="text/javascript">
$(document).ready(function () {
	$('#save_draft').click(function () {
		$(this).prop('disabled', true);
		document.saveDraft();
		$(this).prop('disabled', false);
	});

	$('#submit_form').click(function () {
		$(this).prop('disabled', true);
		document.submit();
		$(this).prop('disabled', false);
	});

	$('#obs\\.apoio_nutricional').change(function(){
		if($('input[name=obs\\.apoio_nutricional]:checked').val() == "1065^SIM^99DCT"){
			$('.apoio_nutricional_div').show();
		} else{
			$('.apoio_nutricional_div').hide();
		}
	});
	$('#obs\\.apoio_nutricional').trigger('change');

	$('#obs\\.tratamento_de_tb').change(function(){
		if($('input[name=obs\\.tratamento_de_tb]:checked').val() == "1065^SIM^99DCT"){
			$('.tratamento_de_tb_div').show();
		} else{
			$('.tratamento_de_tb_div').hide();
		}
	});
	$('#obs\\.tratamento_de_tb').trigger('change');

	$('#obs\\.profilaxia_com_cotrimoxazol').change(function(){
		if($('input[name=obs\\.profilaxia_com_cotrimoxazol]:checked').val() == "1065^SIM^99DCT"){
			$('.profilaxia_com_cotrimoxazol_div').show();
		} else{
			$('.profilaxia_com_cotrimoxazol_div').hide();
		}
	});
	$('#obs\\.profilaxia_com_cotrimoxazol').trigger('change');

	$('#obs\\.profilaxia_com_inh').change(function(){
		if($('input[name=obs\\.profilaxia_com_inh]:checked').val() == "1065^SIM^99DCT"){
			$('.profilaxia_com_inh_div').show();
		} else{
			$('.profilaxia_com_inh_div').hide();
		}
	});
	$('#obs\\.profilaxia_com_inh').trigger('change');

	$('#effeitos_sec_outros').change(function(){
		if($('#effeitos_sec_outros').is(":checked")){
			$('.effeitos_sec_outros_div').show();
		} else{
			$('.effeitos_sec_outros_div').hide();
		}
	});
	$('#effeitos_sec_outros').trigger('change');

	if($('#patient\\.sex').val() == "M"){
		$('.female_gender_check_div').hide();
		$('.male_gender_check_div').show();
	}else{
		$('.female_gender_check_div').show();
		$('.male_gender_check_div').hide();
	}

	$.validator.addMethod("eligibleAgeOnly", function (value, element) {
		if ($.fn.isNotRequiredAndEmpty(value, element)) return true;
		return value > 14;
	}, " "
	);

	// attach 'nonFutureDate' class to perform validation.
	jQuery.validator.addClassRules({
		eligibleAgeOnly: { eligibleAgeOnly: true }
	});

	calculateBMI();

	document.setupAutoCompleteData('encounter\\.location_id');
	document.setupAutoCompleteDataForProvider('encounter\\.provider_id_select');
	document.setupValidationForLocation("$('#encounter\\.location_id').val()","encounter\\.location_id");
	document.setupValidationForProvider("$('#encounter\\.provider_id_select').val()","encounter\\.provider_id");

	var prePopulateData = $.trim($('#pre_populate_data').html());
	var prePopulateJSON = JSON.parse(prePopulateData);
	$.each(prePopulateJSON, function(key, value) {
		if (key === 'patient') {
			var names = "";
			$.each(value, function(keys, values) {
				if(keys === 'patient.given_name' || keys === 'patient.middle_name' || keys === 'patient.family_name' || keys === 'patient.names'){
				   names=names+" "+values;
				}

				if(keys === "patient.birth_date"){
					var tmp = values.split('-');
					if(tmp[2].length==4){
                    	var birthDate = new Date(tmp[2],tmp[1]-1,tmp[0]);
					}else{
						var birthDate = new Date(tmp[0],tmp[1]-1,tmp[2]);
					}
					var today = new Date();
					var milliSecondsInAYear = 1000 * 60 * 60 * 24 * 365.26;
					var age = (today - birthDate) / milliSecondsInAYear;
					$('#patient\\.age').val((Math.floor(age)));
				}
			});
			$('#patient\\.names').val(names);
		}
	});
});

function calculateBMI(){
	var weightKG = parseFloat($('#obs\\.peso').val());
	var heightCm = parseFloat($('#obs\\.altura').val());
	var heightM;
	var IMC;
	if(!isNaN(heightCm) && !isNaN(weightKG)){
		heightM = heightCm/100;
		IMC = weightKG/(heightM*heightM);
		$('#obs\\.imc').val(IMC.toFixed(2));
	}
}
</script>
</html>