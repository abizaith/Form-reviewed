<html xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/muzima.css" rel="stylesheet">
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="css/ui-darkness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui-1.10.4.custom.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <script src="js/muzima.js"></script>
</head>
<body class="col-md-10 col-md-offset-1">
<div id="pre_populate_data"></div>
<form id="VitalSigns_form" name="VitalSigns_form">
    <div class="section">
        <fieldset>
            <h2>LABORATORY ORDERS</h2>
            <h3>Encounter Details</h3>
            <div class="form-group">
                <label for="encounter.location_id">Location Name:<span class="required">*</span></label>
                <input class="form-control valid-location-only" id="encounter.location_id" type="text" placeholder="Start typing something..."
                       required="required">
                <input class="form-control" name="encounter.location_id" type="hidden">
            </div>
            <div class="form-group">
                <label for="encounter.provider_id_select">Provider:</label>
                <input class="form-control valid-provider-only" id="encounter.provider_id_select" type="text" placeholder="Start typing something...">
                <input class="form-control" name="encounter.provider_id_select" type="hidden">
            </div>
            <div class="form-group hidden">
                <select id="select_providers"></select>
            </div>
            <div class="form-group show_provider_id_text">
                <label for="encounter.provider_id">Provider's system-id:<span class="required">*</span></label>
                <input class="form-control checkDigit" id="encounter.provider_id" name="encounter.provider_id"
                       type="text" required="required" disabled="disabled">
            </div>
            <div class="form-group">
                <label for="encounter.encounter_datetime">Encounter Date:<span class="required">*</span></label>
                <input class="form-control datepicker nonFutureDate past-date" id="encounter.encounter_datetime"
                       name="encounter.encounter_datetime" type="text" readonly="readonly"
                       required="required">
            </div>
            <div class="form-group">
                <input class="form-control" id="encounter.form_uuid" name="encounter.form_uuid"
                       type="hidden" required="required">
            </div>
        </fieldset>
    </div>
    <div class="section">
        <fieldset>
            <h3>DEMOGRAPHICS & CLINICAL MEASUREMENTS</h3>

            <div class="form-group">
                <input class="form-control" id="patient.uuid"
                       name="patient.uuid" type="hidden" readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.medical_record_number">Patient identifier:</label>
                <input class="form-control" id="patient.medical_record_number"
                       name="patient.medical_record_number" type="text" readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.given_name">Given Name:</label>
                <input class="form-control" id="patient.given_name" name="patient.given_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.middle_name">Middle Name:</label>
                <input class="form-control" id="patient.middle_name" name="patient.middle_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.family_name">Family Name:</label>
                <input class="form-control" id="patient.family_name" name="patient.family_name" type="text"
                       readonly="readonly">
            </div>
            <div class="form-group">
                <label for="patient.sex">Gender:</label>
                <select class="form-control" id="patient.sex" name="patient.sex" disabled="disabled">
                    <option value="">...</option>
                    <option value="M">Male</option>
                    <option value="F">Female</option>
                </select>
            </div>
            <div class="form-group">
                <label for="patient.birth_date">Date Of Birth:</label>
                <input class="form-control" id="patient.birth_date" name="patient.birth_date" type="text"
                       readonly="readonly" disabled="disabled">
            </div>
        </fieldset>
    </div>


    <div class="sub-section">
        <h3>LABORATORY REQUEST FORM</h3>
        <h2>Covid19 Test</h2>
        <fieldset>
            <div class="form-group">
                <label for="obs.Covidcontroltest">Covid19 test(Number 1-X:</label>
                <input id="obs.Covidcontroltest" class="form-control" name="obs.Covidcontroltest" type="number" data-concept="107305^Covid control test^99DCT"/>
            </div>

            <div class="form-group">
                <label for="obs.TESTINGCODE">Sample code(LabCode):</label>
                <input id="obs.TESTINGCODE" class="form-control" name="obs.TESTINGCODE" type="number" data-concept="13224^TESTING CODE^99DCT"/>
            </div>

            <div class="form-group">
            <h3> Lab exams list </h3>
                <label>
                    <input id="obs.Covid19IgM" name="obs.Covid19IgM" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="107306^Covid19 Ig M^99DCT">
                    Covid19 Ig M
                </label>
                <label>
                    <input id="obs.Covid19IgG" name="obs.Covid19IgG" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="107307^Covid19 Ig G^99DCT">
                    Covid19 Ig G
                </label>
                <label>
                    <input id="obs.SGPTALAT" name="obs.SGPTALAT" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="10402^SGPT -ALAT^99DCT">
                    SGPT -ALAT
                </label>
                <label>
                    <input id="obs.SGOTASAT" name="obs.SGOTASAT" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="10400^SGOT - ASAT^99DCT">
                    SGOT - ASAT
                </label>
                <label>
                    <input id="obs.FULLBLOODCOUNT" name="obs.FULLBLOODCOUNT" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="7836^FULL BLOOD COUNT^99DCT">
                    FULL BLOOD COUNT
                </label>
                <label>
                    <input id="obs.SERUMGLUCOSE" name="obs.SERUMGLUCOSE" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="887^SERUM GLUCOSE^99DCT">
                    SERUM GLUCOSE
                </label>
                <label>
                    <input id="obs.BLOODSMEAR" name="obs.BLOODSMEAR" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="1476^BLOOD SMEAR^99DCT">
                    BLOOD SMEAR
                </label>
                <label>
                    <input id="obs.UREAUREE" name="obs.UREAUREE" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="7245^UREA/UREE^99DCT">
                    UREA/UREE
                </label>
                <label>
                    <input id="obs.SERUMCREATININE" name="obs.SERUMCREATININE" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="790^SERUM CREATININE^99DCT">
                    SERUM CREATININE
                </label>
                <label>
                    <input id="obs.SERUMSODIUM" name="obs.SERUMSODIUM" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="1132^SERUM SODIUM^99DCT">
                    SERUM SODIUM
                </label>
                <label>
                    <input id="obs.SERUMPOTASSIUM" name="obs.SERUMPOTASSIUM" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="1133^SERUM POTASSIUM^99DCT">
                    SERUM POTASSIUM
                </label>
                <label>
                    <input id="obs.SERUMCHLORIDE" name="obs.SERUMCHLORIDE" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="1134^SERUM CHLORIDE^99DCT">
                    SERUM CHLORIDE
                </label>
                <label>
                    <input id="obs.XRAYCHEST" name="obs.RAYCHEST" type="checkbox" data-concept="107310^Frequante Covid19 test^99DCT" value="1134^X RAYCHEST^99DCT">
                    X RAY CHEST
                </label>
            </div>
        </fieldset>
    </div>
        <div class="form-group">
            <label>Other Tests: </label>
            <textarea class="form-control" id="obs.Laboratorytestsothercomments" name="obs.Laboratorytestsothercomments" type="text"  rows="2" data-concept="912a62c3-8b55-4d28-9985-46291138593c^Laboratory tests other comments^99DCT"></textarea>
        </div>

</form>
</body>


<script type="text/javascript">
$(document).ready(function () {
	$('#save_draft').click(function () {
		$(this).prop('disabled', true);
		document.saveDraft();
		$(this).prop('disabled', false);
	});

	$('#submit_form').click(function () {
		$(this).prop('disabled', true);
		document.submit();
		$(this).prop('disabled', false);
	});

	$('#obs\\.apoio_nutricional').change(function(){
		if($('input[name=obs\\.apoio_nutricional]:checked').val() == "1065^SIM^99DCT"){
			$('.apoio_nutricional_div').show();
		} else{
			$('.apoio_nutricional_div').hide();
		}
	});
	$('#obs\\.apoio_nutricional').trigger('change');

	$('#obs\\.tratamento_de_tb').change(function(){
		if($('input[name=obs\\.tratamento_de_tb]:checked').val() == "1065^SIM^99DCT"){
			$('.tratamento_de_tb_div').show();
		} else{
			$('.tratamento_de_tb_div').hide();
		}
	});
	$('#obs\\.tratamento_de_tb').trigger('change');

	$('#obs\\.profilaxia_com_cotrimoxazol').change(function(){
		if($('input[name=obs\\.profilaxia_com_cotrimoxazol]:checked').val() == "1065^SIM^99DCT"){
			$('.profilaxia_com_cotrimoxazol_div').show();
		} else{
			$('.profilaxia_com_cotrimoxazol_div').hide();
		}
	});
	$('#obs\\.profilaxia_com_cotrimoxazol').trigger('change');

	$('#obs\\.profilaxia_com_inh').change(function(){
		if($('input[name=obs\\.profilaxia_com_inh]:checked').val() == "1065^SIM^99DCT"){
			$('.profilaxia_com_inh_div').show();
		} else{
			$('.profilaxia_com_inh_div').hide();
		}
	});
	$('#obs\\.profilaxia_com_inh').trigger('change');

	$('#effeitos_sec_outros').change(function(){
		if($('#effeitos_sec_outros').is(":checked")){
			$('.effeitos_sec_outros_div').show();
		} else{
			$('.effeitos_sec_outros_div').hide();
		}
	});
	$('#effeitos_sec_outros').trigger('change');

	if($('#patient\\.sex').val() == "M"){
		$('.female_gender_check_div').hide();
		$('.male_gender_check_div').show();
	}else{
		$('.female_gender_check_div').show();
		$('.male_gender_check_div').hide();
	}

	$.validator.addMethod("eligibleAgeOnly", function (value, element) {
		if ($.fn.isNotRequiredAndEmpty(value, element)) return true;
		return value > 14;
	}, " "
	);

	// attach 'nonFutureDate' class to perform validation.
	jQuery.validator.addClassRules({
		eligibleAgeOnly: { eligibleAgeOnly: true }
	});

	calculateBMI();
	document.setupAutoCompleteData('encounter\\.location_id');
	document.setupAutoCompleteDataForProvider('encounter\\.provider_id_select');
	document.setupValidationForLocation("$('#encounter\\.location_id').val()","encounter\\.location_id");
	document.setupValidationForProvider("$('#encounter\\.provider_id_select').val()","encounter\\.provider_id");

	var prePopulateData = $.trim($('#pre_populate_data').html());
	var prePopulateJSON = JSON.parse(prePopulateData);
	$.each(prePopulateJSON, function(key, value) {
		if (key === 'patient') {
			var names = "";
			$.each(value, function(keys, values) {
				if(keys === 'patient.given_name' || keys === 'patient.middle_name' || keys === 'patient.family_name' || keys === 'patient.names'){
				   names=names+" "+values;
				}

				if(keys === "patient.birth_date"){
					var tmp = values.split('-');
					if(tmp[2].length==4){
                    	var birthDate = new Date(tmp[2],tmp[1]-1,tmp[0]);
					}else{
						var birthDate = new Date(tmp[0],tmp[1]-1,tmp[2]);
					}
					var today = new Date();
					var milliSecondsInAYear = 1000 * 60 * 60 * 24 * 365.26;
					var age = (today - birthDate) / milliSecondsInAYear;
					$('#patient\\.age').val((Math.floor(age)));
				}
			});
			$('#patient\\.names').val(names);
		}
	});

     var dataDictionary = [
             {"val": "703^POSITIVE^99DCT", "label": "POSITIVE "},
             {"val": "664^NEGATIVE^99DCT", "label": "NEGATIVE "},
             {"val": "1115^NORMAL^99DCT", "label": "NORMAL "},
             {"val": "1116^ABNORMAL^99DCT", "label": "ABNORMAL"}
         ];
     document.setupAutoComplete('obs\\.Results', dataDictionary);

});
function calculateBMI(){
	var weightKG = parseFloat($('#obs\\.peso').val());
	var heightCm = parseFloat($('#obs\\.altura').val());
	var heightM;
	var IMC;
	if(!isNaN(heightCm) && !isNaN(weightKG)){
		heightM = heightCm/100;
		IMC = weightKG/(heightM*heightM);
		$('#obs\\.imc').val(IMC.toFixed(2));
	}
}


</script>
</html>
